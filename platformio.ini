; ESP32-S3 USB Host Configuration
; USB Host requires ESP32-S3 (not supported on ESP32-C3)

; Waveshare ESP32-S3-Zero (recommended)
; PHASE 3: OTG mode for USB Host communication with RetroTINK 4K
[env:esp32s3]
platform = espressif32
board = esp32-s3-devkitc-1  ; Use generic S3 board profile
framework = arduino
monitor_speed = 115200
upload_speed = 921600
board_build.filesystem = littlefs

; Waveshare ESP32-S3-Zero has 4MB flash + 2MB PSRAM
board_upload.flash_size = 4MB
board_build.flash_size = 4MB
board_build.partitions = default.csv

lib_deps =
    bblanchon/ArduinoJson@^7.0.0
    me-no-dev/ESPAsyncWebServer@^1.2.3
    me-no-dev/AsyncTCP@^1.1.1
    fastled/FastLED@^3.6.0
    https://github.com/wakwak-koba/EspUsbHost.git

build_flags =
    -DARDUINO_USB_MODE=0           ; 0 = OTG mode (USB Host for RetroTINK 4K)
    -DARDUINO_USB_CDC_ON_BOOT=0    ; Disable CDC to enable OTG
    -DBOARD_HAS_PSRAM              ; Enable PSRAM support

board_build.f_flash = 80000000L    ; 80MHz flash frequency
board_build.flash_mode = dio       ; Dual I/O mode

; OTA upload scripts - adds 'pio run -t ota' and 'pio run -t otafs' targets
extra_scripts = scripts/ota_upload.py

; CDC mode environment for debugging (no USB Host, Serial.print() works)
; Use this if you need USB serial debugging during development
; [env:esp32s3_cdc]
; platform = espressif32
; board = esp32-s3-devkitc-1
; framework = arduino
; monitor_speed = 115200
; upload_speed = 921600
; board_build.filesystem = littlefs
; board_upload.flash_size = 4MB
; board_build.flash_size = 4MB
; board_build.partitions = default.csv
;
; lib_deps =
;     bblanchon/ArduinoJson@^7.0.0
;     me-no-dev/ESPAsyncWebServer@^1.2.3
;     me-no-dev/AsyncTCP@^1.1.1
;     fastled/FastLED@^3.6.0
;
; build_flags =
;     -DARDUINO_USB_MODE=1           ; 1 = CDC mode (for debugging)
;     -DARDUINO_USB_CDC_ON_BOOT=1    ; Enable CDC for Serial.print()
;     -DBOARD_HAS_PSRAM

; ESP32-C3 Super Mini Plus (UART-only, no USB Host)
; Uses both UARTs: UART0 for switcher, UART1 for RetroTINK
; LED on GPIO8, CDC enabled so Serial -> USB (avoids UART0 conflict)
[env:esp32c3]
platform = espressif32
board = esp32-c3-devkitm-1
framework = arduino
monitor_speed = 115200
upload_speed = 921600
board_build.filesystem = littlefs

lib_deps =
    bblanchon/ArduinoJson@^7.0.0
    me-no-dev/ESPAsyncWebServer@^1.2.3
    me-no-dev/AsyncTCP@^1.1.1
    fastled/FastLED@^3.6.0

build_flags =
    -DARDUINO_USB_MODE=1            ; CDC mode (no USB Host on C3)
    -DARDUINO_USB_CDC_ON_BOOT=1     ; Serial -> USB CDC (keeps UART0 free)
    -DNO_USB_HOST                   ; Exclude UsbHostSerial from build

; Pre-script sets data directory to data_c3/ for C3-specific config
extra_scripts =
    pre:scripts/c3_data_dir.py
    scripts/ota_upload.py

; Alternative: M5Stack ATOMS3 (compact with display)
[env:m5stack_atoms3]
platform = espressif32
board = m5stack-atoms3
framework = arduino
monitor_speed = 115200
upload_speed = 921600
board_build.filesystem = littlefs

lib_deps =
    bblanchon/ArduinoJson@^7.0.0
    me-no-dev/ESPAsyncWebServer@^1.2.3
    me-no-dev/AsyncTCP@^1.1.1
    https://github.com/wakwak-koba/EspUsbHost.git

build_flags =
    -DARDUINO_USB_MODE=1
    -DARDUINO_USB_CDC_ON_BOOT=1
